{% extends 'base.html' %}

{% block header %}
  {% block title %}Home Page | Operations Optimization{% endblock %}
{% endblock %}

{% block content %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>

  {% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class=flashes>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
  {% endwith %}

  <form method="post" enctype="multipart/form-data">
    <label for="channel_id">Channel ID</label><br>
    <input name="channel_id" id="channel_id" ><br>
    <label for="field_id">Field ID</label><br>
    <input name="field_id" id="field_id" ><br>
    <label for="start_date">Start Date</label><br>
    <input type="text" name="start_date" id="start_date" placeholder="YYYY-MM-DD HH:MM:SS" pattern="\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}"  title="Date format should be YYYY-MM-DD HH:MM:SS"><br>
    <label for="time_increment">Time Increment</label><br>
    <input name="time_increment" id="time_increment" ><br>

    <label for="cleanse">Cleanse</label><br>
    <input type="checkbox" name="cleanse" id="cleanse"><br>
    <label for="stdDeviation">Enter Standard Deviations To Cleanse</label><br>
    <input type="number" name="stdDeviation" id="stdDeviation" min="1" step="1" placeholder="Positive integers only" ><br>
    
    <label for="predict">Predict</label><br>
    <input type="checkbox" name="predict" id="predict"><br>
    <label for="prediction_date">Prediction End Date</label><br>
    <input type="text" name="prediction_date" id="prediction_date" placeholder="YYYY-MM-DD HH:MM:SS" pattern="\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}" title="Date format should be YYYY-MM-DD HH:MM:SS"><br>

    <script>
      // JavaScript to make prediction_date required if predict is checked
      document.getElementById('predict').addEventListener('change', function() {
          var predictionDateInput = document.getElementById('prediction_date');
          predictionDateInput.required = this.checked; // Set required based on checkbox
      });

      document.getElementById('cleanse').addEventListener('change', function() {
          var predictionDateInput = document.getElementById('stdDeviation');
          predictionDateInput.required = this.checked; // Set required based on checkbox
      });
    </script>

    <label for="line">Line Chart</label><br>
    <input type="radio" name="chartType" id="line" value="line" required><br>
    <label for="bar">Bar Chart</label><br>
    <input type="radio" name="chartType" id="bar" value="bar" required><br>
    <label for="radar">Radar Chart</label><br>
    <input type="radio" name="chartType" id="radar" value="radar" required><br>
    
    {% if current_user.premium_features %}
      <label for="excelFile">Choose an Excel file:</label>
      <input type="file" name="file" accept=".xlsx, .xls, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
    {% endif %} 
    <button type="submit">Get Data</button><br>

  </form>

  <canvas id="Chart" width="800" height="400"></canvas> <!-- Canvas element where the line chart will be drawn -->
  <script>
    // Get the context of the canvas element we just defined
    var ctx = document.getElementById('Chart').getContext('2d');

    var chart = new Chart(ctx, {
      type: '{{chart_type}}', // Specifies that we want to create a scatter chart
      data: {
        labels: {{labels | safe}}, // Sets the labels for the x-axis from a template variable
        datasets: [{ // Data for the bar chart including the dataset
          label: 'Sensor', // Label for the dataset
          data: {{values | safe}}, // The actual data points for the bar chart from a template variable
          backgroundColor: 'rgba(255, 99, 132, 1)', // Color of the bars
          fill: false,
          borderWidth: 1 // Width of the bars
        }]
      },
      options: {
        responsive: true // Chart will not resize automatically when the container does
      }
    });
  </script>

{% endblock %}


  